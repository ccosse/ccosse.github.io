import{e as ne,v as M,g as r,n as A,av as ae,h as D,i as ue,a9 as se,s as ie,k as le,aa as re,ae as ce}from"./index.e70c2e77.js";import{u as fe,v as R,b as de,c as ve,d as ge,r as H,s as he,p as K,e as me}from"./QBar.fe8d42cc.js";import{u as Ce,a as Pe,b as Te,c as Se}from"./use-prevent-scroll.31fdb8c0.js";import{u as ke,a as xe}from"./use-dark.be8d095a.js";import{e as ye,f as Oe,g as be,h as qe,k as Be,l as Fe,m as W,c as Ee,n as we,o as Me}from"./ClosePopup.03ded20c.js";import{g as Ae}from"./scroll.1cf5a8e4.js";function _e(){const e=new Map;return{getCache:function(o,n){return e[o]===void 0?e[o]=n:e[o]},getCacheWithFn:function(o,n){return e[o]===void 0?e[o]=n():e[o]}}}var je=ne({name:"QMenu",inheritAttrs:!1,props:{...fe,...Ce,...ke,...ye,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:R},self:{type:String,validator:R},offset:{type:Array,validator:de},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...Pe,"click","escapeKey"],setup(e,{slots:o,emit:n,attrs:v}){let s=null,d,c,g;const S=le(),{proxy:h}=S,{$q:a}=h,u=M(null),i=M(!1),Q=r(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),_=xe(e,a),{registerTick:j,removeTick:I}=Oe(),{registerTimeout:k}=Te(),{transitionProps:L,transitionStyle:U}=be(e),{localScrollTarget:x,changeScrollEvent:$,unconfigureScrollTarget:z}=ve(e,E),{anchorEl:l,canShow:G}=ge({showing:i}),{hide:y}=Se({showing:i,canShow:G,handleShow:Y,handleHide:Z,hideOnRouteChange:Q,processOnMount:!0}),{showPortal:O,hidePortal:b,renderPortal:J}=qe(S,u,ee,"menu"),m={anchorEl:l,innerRef:u,onClickOutside(t){if(e.persistent!==!0&&i.value===!0)return y(t),(t.type==="touchstart"||t.target.classList.contains("q-dialog__backdrop"))&&ce(t),!0}},q=r(()=>K(e.anchor||(e.cover===!0?"center middle":"bottom start"),a.lang.rtl)),N=r(()=>e.cover===!0?q.value:K(e.self||"top start",a.lang.rtl)),V=r(()=>(e.square===!0?" q-menu--square":"")+(_.value===!0?" q-menu--dark q-dark":"")),X=r(()=>e.autoClose===!0?{onClick:p}:{}),B=r(()=>i.value===!0&&e.persistent!==!0);A(B,t=>{t===!0?(Me(P),me(m)):(W(P),H(m))});function C(){Ee(()=>{let t=u.value;t&&t.contains(document.activeElement)!==!0&&(t=t.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||t.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||t.querySelector("[autofocus], [data-autofocus]")||t,t.focus({preventScroll:!0}))})}function Y(t){if(s=e.noRefocus===!1?document.activeElement:null,Be(w),O(),E(),d=void 0,t!==void 0&&(e.touchPosition||e.contextMenu)){const T=ae(t);if(T.left!==void 0){const{top:te,left:oe}=l.value.getBoundingClientRect();d={left:T.left-oe,top:T.top-te}}}c===void 0&&(c=A(()=>a.screen.width+"|"+a.screen.height+"|"+e.self+"|"+e.anchor+"|"+a.lang.rtl,f)),e.noFocus!==!0&&document.activeElement.blur(),j(()=>{f(),e.noFocus!==!0&&C()}),k(()=>{a.platform.is.ios===!0&&(g=e.autoClose,u.value.click()),f(),O(!0),n("show",t)},e.transitionDuration)}function Z(t){I(),b(),F(!0),s!==null&&(t===void 0||t.qClickOutside!==!0)&&(((t&&t.type.indexOf("key")===0?s.closest('[tabindex]:not([tabindex^="-"])'):void 0)||s).focus(),s=null),k(()=>{b(!0),n("hide",t)},e.transitionDuration)}function F(t){d=void 0,c!==void 0&&(c(),c=void 0),(t===!0||i.value===!0)&&(Fe(w),z(),H(m),W(P)),t!==!0&&(s=null)}function E(){(l.value!==null||e.scrollTarget!==void 0)&&(x.value=Ae(l.value,e.scrollTarget),$(x.value,f))}function p(t){g!==!0?(we(h,t),n("click",t)):g=!1}function w(t){B.value===!0&&e.noFocus!==!0&&re(u.value,t.target)!==!0&&C()}function P(t){n("escapeKey"),y(t)}function f(){const t=u.value;t===null||l.value===null||he({el:t,offset:e.offset,anchorEl:l.value,anchorOrigin:q.value,selfOrigin:N.value,absoluteOffset:d,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function ee(){return D(se,L.value,()=>i.value===!0?D("div",{role:"menu",...v,ref:u,tabindex:-1,class:["q-menu q-position-engine scroll"+V.value,v.class],style:[v.style,U.value],...X.value},ue(o.default)):null)}return ie(F),Object.assign(h,{focus:C,updatePosition:f}),J}});export{je as Q,_e as u};
