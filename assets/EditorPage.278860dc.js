import{Q as B}from"./QPage.a6f1a6c1.js";import{u as w,s as _}from"./re-store.b0427d37.js";import{a as d,Q}from"./QCardSection.cf481c09.js";import{Q as E}from"./QKnob.abf888dd.js";import{e as R,r as g,u as W,_ as V,o as P,an as T,g as t,w as i,J as p,Q as r,aO as x,k as n,ap as c,j as a,aq as U,ar as G,f as N,l as F}from"./index.d600388f.js";import{d as f,C as m,Q as S}from"./ClosePopup.aee17fcf.js";import{Q as C}from"./QCard.7b650bf7.js";import{Q as k}from"./QInput.fcc64e42.js";import{Q as l}from"./QTooltip.964104bb.js";import{Q as b}from"./QBtnGroup.71242921.js";import{Q as y}from"./QPageSticky.81a1c86c.js";import{s as I}from"./transform.aea72fbe.js";import"./firebase.79bf92f9.js";import"./index.2cf0d985.js";import"./TouchPan.5d90484b.js";import"./use-form.3e87e194.js";import"./use-prevent-scroll.a1a3b042.js";import"./uid.667792d6.js";import"./use-dark.03719e33.js";import"./use-key-composition.f943ac04.js";const A=R({name:"EditorComponent",props:{},setup(s){const e=w();return{props:s,reStore:e,imgCap:g(""),imgSrc:g(""),imgFit:g(""),pageText:g(""),promptAssignmentTitle:g(!1),promptPageTitle:g(!1),promptPctReplace:g(!1),promptLanguage:g(!1),promptGuideWords:g(!1)}},mounted(){console.log("EditorComponent.mounted"),W(this.reStore.courses,async(e,u)=>{console.log("Editor.watch"),e.ck,e.aid,e.pgIdx,e.imgIdx>this.reStore.page.imgs.length-1&&(e.imgIdx=0);const h=e.imgIdx;try{this.imgFit=this.reStore.page.imgFit,this.pageText=this.reStore.page.pageText,this.reStore.page.imgs.length>0?(console.log("try set editor img ",h,this.reStore.page.imgs),this.imgSrc=this.reStore.page.imgs[h].url,this.imgCap=this.reStore.page.imgs[h].cap):console.log("page doesnt have images YET")}catch(v){console.log("ERROR Editor watch ",v,h,this.reStore.page.imgs),this.imgSrc=this.reStore.page.imgs[0].url,this.imgCap=this.reStore.page.imgs[0].cap}},{immediate:!0,deep:!0}),this.reStore.courses.ck,this.reStore.courses.aid,this.reStore.courses.pgIdx;const s=this.reStore.courses.imgIdx;try{this.imgFit=this.reStore.page.imgFit,this.pageText=this.reStore.page.pageText,this.imgSrc=this.reStore.page.imgs[s].url,this.imgCap=this.reStore.page.imgs[s].cap}catch(e){console.log("ERROR Editor mounted",e)}},methods:{takeStorePage(s){this.assignment.pages[s]=JSON.parse(JSON.stringify(this.reStore.page)),this.reStore.courses.trigger+=1},restorePage(s){console.log("Pager restorePage ",s);const e=this.reStore.courses.ck,u=this.reStore.courses.aid;console.log("Pager ",s,e,u),console.log(this.reStore.courses[e]),console.log(this.reStore.courses[e].assignments),console.log(this.reStore.courses[e].assignments[u]),this.assignment.pages[s]=JSON.parse(JSON.stringify(this.reStore.courses[e].assignments[u].pages[s])),this.reStore.courses.pgIdx==s&&(this.reStore.page=JSON.parse(JSON.stringify(this.reStore.courses[e].assignments[u].pages[s])))},updatePage(s){this.reStore.courses[this.reStore.ck].assignments[this.reStore.aid].pages[s]=this.assignment.pages[s],s===this.reStore.courses.pgIdx&&(this.assignment.pages[s].pageText=removeTags(I("#slideTextDiv").html()),this.assignment.pages[s].imgs[this.assignment.pages[s].imgIdx].cap=removeTags(I("#slideCaptionDiv").html()),this.reStore.page=JSON.parse(JSON.stringify(this.assignment.pages[s]))),this.reStore.saveCurrentAssignment(),this.reStore.courses.trigger+=1},pctCB(s){this.targetPgIdx=s,this.targetPctReplace=this.assignment.pages[s].pctReplace,this.promptPctReplace=!0},updatePctReplaceCB(){console.log("updatePctReplaceCB "),this.assignment.pages[this.targetPgIdx].pctReplace=this.targetPctReplace,this.targetPgIdx==this.reStore.courses.pgIdx?(console.log("updating restore.page.pctReplace",this.targetPctReplace,this.assignment.pages[this.targetPgIdx].pctReplace),this.reStore.page.pctReplace=parseInt(this.targetPctReplace)):console.log("Not updating pctReplace",this.targetPgIdx,this.reStore.courses.pgIdx),this.targetPctReplace=null,this.targetPgIdx=null},wpCB(s){console.log("wpCB",s),this.assignment.pages[s].pageid;const e=this.assignment.pages[s].canonicalUrl;window.open(e,"_blank")},gwCB(s){console.log("updateGuideWords",s),this.targetPgIdx=s,this.targetGuideWords=this.assignment.pages[s].guideWords,this.promptGuideWords=!0},mapCB(s){const e="https://maps.google.com/?ll="+this.assignment.pages[s].mapCoords.split(",")[0]+","+this.assignment.pages[s].mapCoords.split(",")[1];window.open(e,"_blank")},updateGuideWordsCB(){console.log(),this.assignment.pages[this.targetPgIdx].guideWords=this.targetGuideWords,this.reStore.courses.pgIdx==this.targetPgIdx?(console.log("updating page guidewords"),this.reStore.page.guideWords=this.targetGuideWords,this.reStore.notify("page guide-words updated ")):console.log("NOT updating page guidewords",this.reStore.courses.pgIdx,this.targetPgIdx),this.targetPgIdx=null,this.targetGuideWords=null},async reloadPage(){console.log("Editor calling reloadPage"),await this.reStore.reloadPage(),console.log("Editor page.imgs ",this.reStore.page.imgs),this.imgFit=this.reStore.page.imgFit,this.pageText=this.reStore.page.pageText,this.imgSrc=this.reStore.page.imgs[0].url,this.imgCap=this.reStore.page.imgs[0].cap},saveImageCB(){const s=this.reStore.courses.imgIdx;this.reStore.saveImage(null,this.reStore.page.imgs[s]),this.reStore.notify("Image saved to MyImages")},prevImg(){this.reStore.page.imgIdx=this.reStore.page.imgIdx-1<0?this.reStore.page.imgs.length-1:this.reStore.page.imgIdx-1,this.reStore.courses.imgIdx=this.reStore.page.imgIdx,this.reStore.setStatus("imgIdx",this.imgIdx),this.imgSrc=this.reStore.page.imgs[this.reStore.courses.imgIdx].url,this.imgCap=this.reStore.page.imgs[this.reStore.courses.imgIdx].cap},nextImg(){this.reStore.page.imgIdx=this.reStore.page.imgIdx+1>this.reStore.page.imgs.length-1?0:this.reStore.page.imgIdx+1,this.reStore.courses.imgIdx=this.reStore.page.imgIdx,this.reStore.setStatus("imgIdx",this.reStore.courses.imgIdx),this.imgSrc=this.reStore.page.imgs[this.reStore.courses.imgIdx].url,this.imgCap=this.reStore.page.imgs[this.reStore.courses.imgIdx].cap},toggleText(){I("#slideTextDiv").classed("hidden")?_("#slideTextDiv").classed("hidden",!1):_("#slideTextDiv").classed("hidden",!0)},cycleFitMode(){const s=["scale-down","cover"];let e=s.indexOf(this.imgFit);e+=1,e>s.length-1&&(e=0),this.reStore.page.imgFit=s[e],this.reStore.courses.trigger+=1},setCover(){this.reStore.courses.ck,this.reStore.courses.aid,this.reStore.courses.pgIdx;const s=this.reStore.courses.imgIdx,e=this.reStore.page.imgs[s].url;this.reStore.setCover(this.reStore.page.imgs[s]),console.log("coverUrl ",e)}}}),D=n("div",{class:"text-h6"},"Percent Replace",-1),q=n("div",{class:"text-h6"},"Guide Words",-1),J=n("div",{class:"text-h6"},"Assignment Title",-1),O=n("div",{class:"text-h6"},"Page Title",-1),K={id:"slideCaptionDiv",class:"absolute-top text-subtitle1 text-center q-my-xl assignment",contentEditable:"true"},z={id:"slideTextDiv",class:"text-panel text-center absolute-center assignment",contentEditable:"true"},M={key:0},L={id:"coverSlideDiv",class:"flex flex-center cover-panel absolute-center coverslide hidden",contentEditable:"false"},H={class:"q-ma-md"},Y=n("br",null,null,-1),X=n("br",null,null,-1),Z={class:"q-ma-md"},j=n("br",null,null,-1),ee=n("br",null,null,-1),te=n("br",null,null,-1),se=n("br",null,null,-1);function ie(s,e,u,h,v,$){return P(),T(G,null,[t(S,{modelValue:s.promptPctReplace,"onUpdate:modelValue":e[2]||(e[2]=o=>s.promptPctReplace=o),persistent:""},{default:i(()=>[t(C,{style:{"min-width":"350px"}},{default:i(()=>[t(d,{align:"center"},{default:i(()=>[D]),_:1}),t(d,{class:"q-pt-none",align:"center"},{default:i(()=>[t(E,{"show-value":"",size:"140px",thickness:.5,color:"green","track-color":"green-3","center-color":"grey-8",class:"text-white col q-ma-md",modelValue:s.targetPctReplace,"onUpdate:modelValue":e[0]||(e[0]=o=>s.targetPctReplace=o)},null,8,["modelValue"])]),_:1}),t(f,{align:"right"},{default:i(()=>[p(t(r,{outline:"",label:"Cancel"},null,512),[[m]]),p(t(r,{outline:"",label:"Update % replace",onClick:e[1]||(e[1]=o=>this.updatePctReplaceCB())},null,512),[[m]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(S,{modelValue:s.promptGuideWords,"onUpdate:modelValue":e[6]||(e[6]=o=>s.promptGuideWords=o),persistent:""},{default:i(()=>[t(C,{style:{"min-width":"350px"}},{default:i(()=>[t(d,null,{default:i(()=>[q]),_:1}),t(d,{class:"q-pt-none"},{default:i(()=>[t(k,{dense:"",modelValue:this.targetGuideWords,"onUpdate:modelValue":e[3]||(e[3]=o=>this.targetGuideWords=o),autofocus:"",onKeyup:e[4]||(e[4]=x(o=>s.promptGuideWords=!1,["enter"]))},null,8,["modelValue"])]),_:1}),t(f,{align:"right"},{default:i(()=>[p(t(r,{outline:"",label:"Cancel"},null,512),[[m]]),p(t(r,{outline:"",label:"Update guide words",onClick:e[5]||(e[5]=o=>this.updateGuideWordsCB())},null,512),[[m]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(S,{modelValue:s.promptAssignmentTitle,"onUpdate:modelValue":e[10]||(e[10]=o=>s.promptAssignmentTitle=o),persistent:""},{default:i(()=>[t(C,{style:{"min-width":"350px"}},{default:i(()=>[t(d,null,{default:i(()=>[J]),_:1}),t(d,{class:"q-pt-none"},{default:i(()=>[t(k,{dense:"",modelValue:this.assignment.title,"onUpdate:modelValue":e[7]||(e[7]=o=>this.assignment.title=o),autofocus:"",onKeyup:e[8]||(e[8]=x(o=>s.promptAssignmentTitle=!1,["enter"]))},null,8,["modelValue"])]),_:1}),t(f,{align:"right"},{default:i(()=>[p(t(r,{outline:"",label:"Cancel"},null,512),[[m]]),p(t(r,{outline:"",label:"Update assignment title",onClick:e[9]||(e[9]=o=>this.updateAssignmentTitle())},null,512),[[m]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(S,{modelValue:s.promptPageTitle,"onUpdate:modelValue":e[14]||(e[14]=o=>s.promptPageTitle=o),persistent:""},{default:i(()=>[t(C,{style:{"min-width":"350px"}},{default:i(()=>[t(d,null,{default:i(()=>[O]),_:1}),t(d,{class:"q-pt-none"},{default:i(()=>[t(k,{dense:"",modelValue:this.reStore.page.pageTitle,"onUpdate:modelValue":e[11]||(e[11]=o=>this.reStore.page.pageTitle=o),autofocus:"",onKeyup:e[12]||(e[12]=x(o=>s.promptAssignmentTitle=!1,["enter"]))},null,8,["modelValue"])]),_:1}),t(f,{align:"right"},{default:i(()=>[p(t(r,{outline:"",label:"Cancel"},null,512),[[m]]),p(t(r,{outline:"",label:"Update page title",onClick:e[13]||(e[13]=o=>this.updatePageTitle())},null,512),[[m]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Q,{class:"fixed-center",src:this.imgSrc,fit:this.imgFit,height:"100%"},{default:i(()=>[n("div",K,c(this.imgCap),1)]),_:1},8,["src","fit"]),n("div",z,c(this.pageText),1),this.reStore.courses.aid?(P(),T("span",M,[n("div",L,[n("div",H,[t(r,{style:{width:"200px",height:"200px","font-size":"12pt"},color:"primary"},{default:i(()=>[a(c(this.reStore.courses[this.reStore.courses.ck].assignments[this.reStore.courses.aid].title)+" ",1),Y,a(" "+c(this.reStore.courses[this.reStore.courses.ck].assignments[this.reStore.courses.aid].pages.length)+" Pages ",1),X,a(" "+c(this.reStore.courses[this.reStore.courses.ck].assignments[this.reStore.courses.aid].goal)+" Points ",1)]),_:1})]),n("div",Z,[t(r,{style:{width:"200px",height:"200px","font-size":"24pt"},stack:"",size:"xl","icon-right":"play_circle","text-color":"white",color:"primary",onClick:e[15]||(e[15]=o=>this.reStore.startAssignment())},{default:i(()=>[a("Start")]),_:1})])])])):U("",!0),t(y,{position:"bottom",offset:[0,10],class:"assignment"},{default:i(()=>[t(b,null,{default:i(()=>[t(r,{fab:"","label-position":"left",color:"primary",icon:"arrow_left",onClick:this.prevImg,padding:"sm"},{default:i(()=>[t(l,null,{default:i(()=>[a(" Previous image (same Wikipedia page) ")]),_:1})]),_:1},8,["onClick"]),t(r,{color:"primary"},{default:i(()=>[a(c(this.reStore.courses.imgIdx+1)+"/"+c(this.reStore.page.imgs.length),1)]),_:1}),t(r,{fab:"","label-position":"right",color:"primary",icon:"arrow_right",onClick:this.nextImg,padding:"sm"},null,8,["onClick"]),t(l,null,{default:i(()=>[a(" Next image (same Wikipedia page) ")]),_:1})]),_:1})]),_:1}),t(y,{position:"bottom",offset:[0,60],class:"assignment"},{default:i(()=>[t(b,null,{default:i(()=>[t(r,{fab:"","label-position":"right",color:"primary",icon:"add_photo_alternate",onClick:e[16]||(e[16]=o=>this.saveImageCB()),padding:"sm"},{default:i(()=>[t(l,null,{default:i(()=>[a("Bookmark this image")]),_:1})]),_:1}),t(r,{fab:"","label-position":"right",color:"primary",icon:"bookmark_add",onClick:e[17]||(e[17]=o=>this.reStore.saveBookmark()),padding:"sm"},{default:i(()=>[t(l,null,{default:i(()=>[a("Bookmark this page")]),_:1})]),_:1}),t(r,{fab:"","label-position":"right",color:"primary",icon:"fit_screen",onClick:this.cycleFitMode,padding:"sm"},{default:i(()=>[t(l,null,{default:i(()=>[a("Cycle through image-fit modes")]),_:1})]),_:1},8,["onClick"]),t(r,{fab:"","label-position":"right",color:"primary",icon:"article",onClick:this.toggleText,padding:"sm"},{default:i(()=>[t(l,null,{default:i(()=>[a("Show/Hide paragraph text in order to get"),j,a("better view of image.")]),_:1})]),_:1},8,["onClick"]),t(r,{fab:"","label-position":"right",color:"primary",icon:"title",onClick:this.setCover,padding:"sm"},{default:i(()=>[t(l,null,{default:i(()=>[a("Set current image as Cover Image for current assignment,"),ee,a("if there is an assignment currently loaded.")]),_:1})]),_:1},8,["onClick"]),t(r,{fab:"","label-position":"right",color:"primary",icon:"volume_up",onClick:e[18]||(e[18]=o=>this.reStore.speak()),padding:"sm"},{default:i(()=>[t(l,null,{default:i(()=>[a("Speak current text")]),_:1})]),_:1}),t(r,{fab:"","label-position":"right",color:"primary",icon:"arrow_right",onClick:this.reloadPage,padding:"xs"},{default:i(()=>[t(l,null,{default:i(()=>[a(" Reload page content. If Custom then no changes."),te,a(" If pageid, then only saved imgIdx applies."),se,a(" Else, reloads random with guid-words, if any. ")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1}),t(y,{position:"bottom",offset:[0,110],class:"assignment"},{default:i(()=>[t(b,null,{default:i(()=>[t(r,{fab:"","label-position":"left",color:"primary",icon:"input",onClick:e[19]||(e[19]=o=>s.takeStorePage(s.pgIdx)),padding:"sm"},{default:i(()=>[t(l,null,{default:i(()=>[a(" Pull editor page contents to this Page ")]),_:1})]),_:1}),t(r,{fab:"","label-position":"left",color:"primary",icon:"restore_page",onClick:e[20]||(e[20]=o=>s.restorePage(s.pgIdx)),padding:"sm"},{default:i(()=>[t(l,null,{default:i(()=>[a(" Restore page to saved values ")]),_:1})]),_:1}),t(r,{fab:"","label-position":"left",color:"primary",icon:"save",onClick:e[21]||(e[21]=o=>this.updatePage(s.pgIdx)),padding:"sm"},{default:i(()=>[t(l,null,{default:i(()=>[a(" Update & Save current page ")]),_:1})]),_:1}),t(r,{fab:"","label-position":"left",color:"primary",icon:"signpost",onClick:e[22]||(e[22]=o=>s.gwCB(s.pgIdx)),padding:"sm"},{default:i(()=>[t(l,null,{default:i(()=>[a(" Update & Save current page ")]),_:1})]),_:1}),t(r,{fab:"","label-position":"left",color:"primary",icon:"percent",onClick:e[23]||(e[23]=o=>s.pctCB(s.pgIdx)),padding:"sm"},{default:i(()=>[t(l,null,{default:i(()=>[a("Set percentage of words to replace from paragraph on this page ")]),_:1})]),_:1}),t(r,{fab:"","label-position":"left",color:"primary",icon:"location_on",onClick:e[24]||(e[24]=o=>s.mapCB(s.pgIdx)),padding:"sm"},{default:i(()=>[t(l,null,{default:i(()=>[a(" Launch Google Maps: ")]),_:1})]),_:1}),t(r,{fab:"","label-position":"left",color:"primary",icon:"language",onClick:e[25]||(e[25]=o=>s.wpCB(s.pgIdx)),padding:"sm"},{default:i(()=>[t(l,null,{default:i(()=>[a("Wikipedia page ")]),_:1})]),_:1})]),_:1})]),_:1})],64)}var oe=V(A,[["render",ie]]);const re=R({name:"EditorPage",components:{EditorComponent:oe},setup(s){const e=w();return{props:s,reStore:e}}});function ae(s,e,u,h,v,$){const o=F("EditorComponent");return P(),N(B,{id:"QPage",class:"row justify-center"},{default:i(()=>[t(o)]),_:1})}var Te=V(re,[["render",ae]]);export{Te as default};
