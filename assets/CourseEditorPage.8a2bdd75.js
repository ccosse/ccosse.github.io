import{Q as V}from"./QPage.5878960d.js";import{u as N}from"./re-store.18599349.js";import{Q as A}from"./QCardSection.f1c1c46f.js";import{Q as U}from"./QInput.863d2f93.js";import{e as T,r as g,u as G,_ as K,o as h,f as x,w as l,g as s,aO as I,O as E,Q as u,k as d,an as _,ap as w,aq as Q,j as a,i as D,ar as q,as as L,at as B,l as J}from"./index.0593ff5d.js";import{Q as R,d as W,C as b}from"./ClosePopup.7de35dad.js";import{Q as O}from"./QCard.08d12015.js";import{Q as j}from"./QBanner.bc181134.js";import{Q as m}from"./QTooltip.f87d82fb.js";import{Q as $}from"./QBtnGroup.b24f841b.js";import{Q as F}from"./QExpansionItem.f1c43f19.js";import{Q as M}from"./QImg.1f3e2eaf.js";import"./firebase.79bf92f9.js";import"./transform.aea72fbe.js";import"./index.2cf0d985.js";import"./use-key-composition.c27381be.js";import"./use-dark.247fe131.js";import"./uid.42677368.js";import"./scroll.93d34c24.js";import"./use-form.bbc6f152.js";import"./use-prevent-scroll.9391e725.js";const z=T({name:"CourseEditor",setup(){return{reStore:N(),course:g(null),defaultExpanded:g(!0),promptAwesome:g(!1),targetCK:g(null),targetAID:g(null),autoAwesomeGuideWords:g("")}},mounted(){console.log("CE mounted"),G(this.reStore.courses,async(o,t)=>{if(console.log("CE watcher ",o,t),!this.assignment||this.assignment.id!==o.aid){const p=this.reStore.courses.ck;this.course=JSON.parse(JSON.stringify(this.reStore.courses[p]))}});try{if(!this.course||this.course.courseKey!==newObj.ck){const o=this.reStore.courses.ck;this.course=JSON.parse(JSON.stringify(this.reStore.courses[o]))}}catch(o){console.log(o)}},methods:{autoAwesomeCB(o){console.log("autoAwesomeCB ",this.autoAwesomeGuideWords);const t=this.autoAwesomeGuideWords.split(","),p=200,v=p/t.length;let C=parseInt(v/6);C<1&&(C=1);const r=JSON.parse(JSON.stringify(this.reStore.assignmentTemplate));r.ck=this.targetCK,r.id=this.reStore.mkId(),r.pgIdx=0,r.coverUrl=null,r.title=t[0],r.goal=p,t.forEach(async i=>{const f=this.reStore.langVoices[this.reStore.preferences.langVoiceKey];console.log("doSearch ",f,this.searchTerms),this.reStore.wiki.setLang(f.langName);const c=await this.reStore.wiki.search(i,{suggestion:!1,limit:C});console.log("res.results.length: ",c.results.length),console.log(c.results),c.results.forEach(async k=>{console.log(k.pageid),await this.reStore.getPage2(null,k.pageid,this.reStore.preferences.langVoiceKey).then(async n=>{console.log("getPage returned rval ",n),n.pageTitle=k.title;const S=await this.reStore.wiki.page(k.pageid);n.canonicalUrl=S.canonicalurl;const y=await S.summary();if(y.type!=="disambiguation"){if(await S.coordinates().then(e=>{console.log("resolved coords ",e),e!==null?n.mapCoords=`${e.lat}, ${e.lon}`:n.mapCoords="-999, -999"}),await S.images({limit:this.reStore.preferences.imgLimit}).then(e=>{for(const P in e)console.log(P),e[0].title.indexOf(".svg")>1?console.log("SVG ",e[0].title):e[0].title.indexOf("airytale")>0?console.log("Fairytale warning ",e[0].title):e[0].title.indexOf("kguitar")>1?console.log("kguitar ",e[0].title):e[0].title.indexOf("Blank.png")>-1?console.log("Blank.png ",e[0].title):e[0].title.indexOf(".oga")>1?console.log("OGA ",e[0].title):e[0].title.indexOf(".webm")>1?console.log("WEBM ",e[0].title):e[0].title.indexOf(".ogg")>1?console.log("OGG ",e[0].title):e[0].title.indexOf(".tif")>1?console.log("TIF ",e[0].title):e[0].title.indexOf(".mid")>1?console.log("MID ",e[0].title):e[0].title.indexOf(".ogv")>1?console.log("OGV ",e[0].title):e[0].title.indexOf("Icon")>1?console.log("ICON ",e[0].title):e[0].title.indexOf("icon")>1?console.log("icon ",e[0].title):e[0].title.indexOf("podagraria1")>0?console.log("podagraria1 ",e[0].title):e[0].title.indexOf("Bluetank")>1||e[0].title.indexOf("rab Nebula.jpg")>0?console.log("BLUETANK ",e[0].title):e[0].title.indexOf("viacionavion")>1||e[0].title.indexOf("input-microphone")>1?console.log("viacionavion",e[0].title):e[0].title.indexOf("clouds in fair weather")>0||e[0].title.indexOf("in pacifica 1")>0?console.log("clouds in fair weather",e[0].title):n.imgs.push({url:e[0].url,cap:e[0].title}),e.push(e.shift());n.imgs.length>1&&n.imgs.shift()}),n.pageText=y.extract,n.currentLangLinks=[],n.imgIdx=0,!r.coverUrl)try{r.coverUrl=r.pages[0].imgs[0].url}catch(e){console.log("ERROR setting coverUrl ",e)}r.pages.push(n),console.log("a.pages.length ",r.pages.length)}else console.log("SKIPPED ",y.type)})})}),this.reStore.courses[this.reStore.courses.ck].assignments||(this.reStore.courses[this.reStore.courses.ck].assignments={}),this.reStore.courses[this.reStore.courses.ck].assignments[r.id]=r,this.reStore.courses.trigger+=1},takeAssignmentCB(o){console.log("CE takeAssignmentCB ",o),o!==this.reStore.courses.aid&&this.loadAssignmentCB(o),this.reStore.router.push("/teacher/assignment")},editAssignmentCB(o){console.log("CE editAssignmentCB ",o),o!==this.reStore.courses.aid&&this.loadAssignmentCB(o),this.reStore.router.push("/teacher/assignmenteditor")},loadAssignmentCB(o){const t=this.reStore.courses.ck;console.log("CE loadAssignmentCB ",t,o),this.reStore.loadAssignment(t,o),this.reStore.courses.selectedRHSTab="pagerTab"},newAssignmentCB(o){console.log("assignmentCB: ",o),this.reStore.newAssignment(o)},removeAssignmentCB(o){const t=this.reStore.courses.ck;console.log("removeAssignmentCB",t,o),this.reStore.deleteAssignment(t,o),console.log("done")},dummy(){console.log("dummy")}}}),H=d("div",{class:"text-h6"},"Provide guide-words",-1),X={class:"q-pa-md"},Y={key:0,class:"text-weight-bolder text-center text-h4 q-pa-md"},Z={class:"q-ma-sm"},ee=d("br",null,null,-1),te=d("br",null,null,-1),oe={key:0,class:"flex flex-row justify-center"},se={class:"absolute-top text-center",style:{"background-color":"#2228",height:"100%"}},le={class:"atit"},ie={class:"asub"};function re(o,t,p,v,C,r){return h(),x(V,{class:"q-gutter-md bg-primary",style:{width:"100%"}},{default:l(()=>[s(R,{modelValue:o.promptAwesome,"onUpdate:modelValue":t[3]||(t[3]=i=>o.promptAwesome=i),persistent:"",class:"z-max"},{default:l(()=>[s(O,{style:{"min-width":"350px"}},{default:l(()=>[s(A,null,{default:l(()=>[H]),_:1}),s(A,{class:"q-pt-none"},{default:l(()=>[s(U,{dense:"",modelValue:o.autoAwesomeGuideWords,"onUpdate:modelValue":t[0]||(t[0]=i=>o.autoAwesomeGuideWords=i),autofocus:"",onKeyup:t[1]||(t[1]=I(i=>{o.promptAwesome=!1,this.autoAwesomeCB()},["enter"]))},null,8,["modelValue"])]),_:1}),s(W,{align:"right",class:"text-white"},{default:l(()=>[E(s(u,{outline:"",label:"Cancel"},null,512),[[b]]),E(s(u,{outline:"",label:"Save",onClick:t[2]||(t[2]=i=>this.autoAwesomeCB())},null,512),[[b]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),d("div",X,[s(F,{class:"bg-positive",modelValue:o.defaultExpanded,"onUpdate:modelValue":t[10]||(t[10]=i=>o.defaultExpanded=i)},{header:l(()=>[s(j,{class:"bg-positive text-white",style:{width:"100%"}},{default:l(()=>[this.reStore.courses.ck?(h(),_("div",Y," Course: "+w(this.reStore.courses[this.reStore.courses.ck].title),1)):Q("",!0)]),_:1})]),default:l(()=>[s(O,{flat:""},{default:l(()=>[s(A,{class:"text-center",style:{fontSize:"12pt"}},{default:l(()=>[a(" Title: "+w(this.reStore.courses[this.reStore.courses.ck].title)+" \xA0",1),s(D,{class:"ptr",name:"edit",onClick:t[4]||(t[4]=i=>{o.prompt=!0,this.courseTitle=this.reStore.courses[this.reStore.courses.ck].title,this.courseKey=o.ck})}),d("div",Z,[s($,null,{default:l(()=>[s(u,{icon:"delete",onClick:t[5]||(t[5]=i=>this.deleteCourseCB(this.reStore.courses.ck))},{default:l(()=>[s(m,null,{default:l(()=>[a("Delete Course")]),_:1})]),_:1}),s(u,{icon:"post_add",onClick:t[6]||(t[6]=i=>this.newAssignmentCB(this.reStore.courses.ck))},{default:l(()=>[s(m,null,{default:l(()=>[a("New Assignment")]),_:1})]),_:1}),s(u,{icon:"auto_awesome",onClick:t[7]||(t[7]=i=>{this.targetCK=o.ck,o.promptAwesome=!0})},{default:l(()=>[s(m,null,{default:l(()=>[a("1-Step Custom Assignment Create")]),_:1})]),_:1}),s(u,{icon:"content_copy",onClick:t[8]||(t[8]=i=>this.copyCK(o.ck))},{default:l(()=>[s(m,null,{default:l(()=>[a("Copy this course-key to clipboard. Enroll "),ee,a("in this course using this course-key from "),te,a("the Student Page.")]),_:1})]),_:1}),s(u,{icon:"home",onClick:t[9]||(t[9]=i=>this.reStore.router.push("/teacher"))},{default:l(()=>[s(m,null,{default:l(()=>[a("Return to dashboard")]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),this.course?(h(),_("div",oe,[(h(!0),_(q,null,L(this.course.assignments,(i,f)=>(h(),x(O,{class:"acard bg-primary q-ma-sm",flat:"",bordered:"",modelValue:this.course.assignments,"onUpdate:modelValue":t[14]||(t[14]=c=>this.course.assignments=c),key:f},{default:l(()=>[s(M,{class:"aimg",src:i.coverUrl,onClick:c=>this.loadAssignmentCB(f)},{default:l(()=>[d("div",se,[d("div",le,w(i.title.slice(0,10)),1),d("div",null,[d("span",ie,"Pages: "+w(i.pages.length),1)])]),s($,{dense:"",class:"absolute-bottom justify-center",style:{"background-color":"#0000"}},{default:l(()=>[s(u,{dense:"",color:"",class:"on-left",icon:"delete",onClick:[t[11]||(t[11]=B(()=>{},["stop","prevent"])),c=>this.removeAssignmentCB(f)]},{default:l(()=>[s(m,null,{default:l(()=>[a("Delete Assignment")]),_:1})]),_:2},1032,["onClick"]),s(u,{dense:"",icon:"play_circle",onClick:[t[12]||(t[12]=B(()=>{},["stop","prevent"])),c=>this.takeAssignmentCB(f)]},{default:l(()=>[s(m,null,{default:l(()=>[a("Take Assignment")]),_:1})]),_:2},1032,["onClick"]),s(u,{dense:"",class:"on-right",icon:"edit",onClick:[t[13]||(t[13]=B(()=>{},["stop","prevent"])),c=>this.editAssignmentCB(f)]},{default:l(()=>[s(m,null,{default:l(()=>[a("Edit Assignment")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["src","onClick"])]),_:2},1032,["modelValue"]))),128))])):Q("",!0)]),_:1})}var ne=K(z,[["render",re]]);const ae=T({name:"CourseEditorPage",components:{CourseEditor:ne},setup(o){const t=N();return{props:o,reStore:t}}});function ue(o,t,p,v,C,r){const i=J("CourseEditor");return h(),x(V,{id:"QPage",class:"row justify-center"},{default:l(()=>[s(i)]),_:1})}var $e=K(ae,[["render",ue]]);export{$e as default};
