import{Q as V}from"./QPage.7d47aa6a.js";import{u as N}from"./re-store.dee276a0.js";import{a as _,Q as U}from"./QCardSection.7a8e8198.js";import{Q as G}from"./QInput.eb11786c.js";import{e as K,r as h,u as I,_ as P,o as p,f as v,w as s,g as l,aO as D,J as Q,Q as u,k as c,j as a,an as B,ap as w,aq as O,i as q,ar as J,as as L,at as x,l as W}from"./index.89842271.js";import{Q as j,d as R,C as $}from"./ClosePopup.8f1204f3.js";import{Q as E}from"./QCard.42ec64f3.js";import{Q as F}from"./QBanner.3d72183c.js";import{Q as m}from"./QTooltip.59ddce99.js";import{Q as b}from"./QBtnGroup.235877a2.js";import{Q as M}from"./QExpansionItem.e30fa5be.js";import"./firebase.79bf92f9.js";import"./transform.aea72fbe.js";import"./index.2cf0d985.js";import"./use-key-composition.f856fd0d.js";import"./use-dark.1ee1890c.js";import"./uid.4f7d2bc7.js";import"./use-form.24c9bae0.js";import"./use-prevent-scroll.86379370.js";const z=K({name:"CourseEditor",setup(){return{reStore:N(),course:h(null),defaultExpanded:h(!0),promptAwesome:h(!1),targetCK:h(null),targetAID:h(null),autoAwesomeGuideWords:h("")}},mounted(){console.log("CE mounted"),I(this.reStore.courses,async(o,t)=>{if(console.log("CE watcher ",o,t),!this.assignment||this.assignment.id!==o.aid){const g=this.reStore.ck;this.course=JSON.parse(JSON.stringify(this.reStore.courses[g]))}});try{if(!this.course||this.course.courseKey!==newObj.ck){const o=this.reStore.ck;this.course=JSON.parse(JSON.stringify(this.reStore.courses[o]))}}catch{console.log("No course yet")}},methods:{autoAwesomeCB(o){console.log("autoAwesomeCB ",this.autoAwesomeGuideWords);const t=this.autoAwesomeGuideWords.split(","),g=200,y=g/t.length;let C=parseInt(y/6);C<1&&(C=1);const n=JSON.parse(JSON.stringify(this.reStore.assignmentTemplate));n.ck=this.targetCK,n.id=this.reStore.mkId(),n.pgIdx=0,n.coverUrl=null,n.title=t[0],n.goal=g,t.forEach(async i=>{const f=this.reStore.langVoices[this.reStore.preferences.langVoiceKey];console.log("doSearch ",f,this.searchTerms),this.reStore.wiki.setLang(f.langName);const d=await this.reStore.wiki.search(i,{suggestion:!1,limit:C});console.log("res.results.length: ",d.results.length),console.log(d.results),d.results.forEach(async k=>{console.log(k.pageid),await this.reStore.getPage2(null,k.pageid,this.reStore.preferences.langVoiceKey).then(async r=>{console.log("getPage returned rval ",r),r.pageTitle=k.title;const S=await this.reStore.wiki.page(k.pageid);r.canonicalUrl=S.canonicalurl;const A=await S.summary();if(A.type!=="disambiguation"){if(await S.coordinates().then(e=>{console.log("resolved coords ",e),e!==null?r.mapCoords=`${e.lat}, ${e.lon}`:r.mapCoords="-999, -999"}),await S.images({limit:this.reStore.preferences.imgLimit}).then(e=>{for(const T in e)console.log(T),e[0].title.indexOf(".svg")>1?console.log("SVG ",e[0].title):e[0].title.indexOf("airytale")>0?console.log("Fairytale warning ",e[0].title):e[0].title.indexOf("kguitar")>1?console.log("kguitar ",e[0].title):e[0].title.indexOf("Blank.png")>-1?console.log("Blank.png ",e[0].title):e[0].title.indexOf(".oga")>1?console.log("OGA ",e[0].title):e[0].title.indexOf(".webm")>1?console.log("WEBM ",e[0].title):e[0].title.indexOf(".ogg")>1?console.log("OGG ",e[0].title):e[0].title.indexOf(".tif")>1?console.log("TIF ",e[0].title):e[0].title.indexOf(".mid")>1?console.log("MID ",e[0].title):e[0].title.indexOf(".ogv")>1?console.log("OGV ",e[0].title):e[0].title.indexOf("Icon")>1?console.log("ICON ",e[0].title):e[0].title.indexOf("icon")>1?console.log("icon ",e[0].title):e[0].title.indexOf("podagraria1")>0?console.log("podagraria1 ",e[0].title):e[0].title.indexOf("Bluetank")>1||e[0].title.indexOf("rab Nebula.jpg")>0?console.log("BLUETANK ",e[0].title):e[0].title.indexOf("viacionavion")>1||e[0].title.indexOf("input-microphone")>1?console.log("viacionavion",e[0].title):e[0].title.indexOf("clouds in fair weather")>0||e[0].title.indexOf("in pacifica 1")>0?console.log("clouds in fair weather",e[0].title):r.imgs.push({url:e[0].url,cap:e[0].title}),e.push(e.shift());r.imgs.length>1&&r.imgs.shift()}),r.pageText=A.extract,r.currentLangLinks=[],r.imgIdx=0,!n.coverUrl)try{n.coverUrl=n.pages[0].imgs[0].url}catch(e){console.log("ERROR setting coverUrl ",e)}n.pages.push(r),console.log("a.pages.length ",n.pages.length)}else console.log("SKIPPED ",A.type)})})}),this.reStore.courses[this.reStore.courses.ck].assignments||(this.reStore.courses[this.reStore.courses.ck].assignments={}),this.reStore.courses[this.reStore.courses.ck].assignments[n.id]=n,this.reStore.courses.trigger+=1},takeAssignmentCB(o){console.log("CE takeAssignmentCB ",o),o!==this.reStore.courses.aid&&this.loadAssignmentCB(o),this.reStore.router.push("/teacher/assignment")},editAssignmentCB(o){console.log("CE editAssignmentCB ",o),o!==this.reStore.courses.aid&&this.loadAssignmentCB(o),this.reStore.router.push("/teacher/assignmenteditor")},loadAssignmentCB(o){const t=this.reStore.courses.ck;console.log("CE loadAssignmentCB ",t,o),this.reStore.loadAssignment(t,o),this.reStore.loadCover()},newAssignmentCB(o){console.log("assignmentCB: ",o),this.reStore.newAssignment(o)},removeAssignmentCB(o){const t=this.reStore.courses.ck;console.log("removeAssignmentCB",t,o),this.reStore.deleteAssignment(t,o),console.log("done")},dummy(){console.log("dummy")}}}),H=c("div",{class:"text-h6"},"Provide guide-words",-1),X={class:"q-pa-md"},Y={class:"text-weight-bolder text-center text-h4 q-pa-md"},Z={key:0},ee={class:"q-ma-sm"},te=c("br",null,null,-1),oe=c("br",null,null,-1),se={key:0,class:"flex flex-row justify-center"},le={class:"absolute-top text-center",style:{"background-color":"#2228",height:"100%"}},ie={class:"atit"},ne={class:"asub"};function re(o,t,g,y,C,n){return p(),v(V,{class:"q-gutter-md bg-primary",style:{width:"100%"}},{default:s(()=>[l(j,{modelValue:o.promptAwesome,"onUpdate:modelValue":t[3]||(t[3]=i=>o.promptAwesome=i),persistent:"",class:"z-max"},{default:s(()=>[l(E,{style:{"min-width":"350px"}},{default:s(()=>[l(_,null,{default:s(()=>[H]),_:1}),l(_,{class:"q-pt-none"},{default:s(()=>[l(G,{dense:"",modelValue:o.autoAwesomeGuideWords,"onUpdate:modelValue":t[0]||(t[0]=i=>o.autoAwesomeGuideWords=i),autofocus:"",onKeyup:t[1]||(t[1]=D(i=>{o.promptAwesome=!1,this.autoAwesomeCB()},["enter"]))},null,8,["modelValue"])]),_:1}),l(R,{align:"right",class:"text-white"},{default:s(()=>[Q(l(u,{outline:"",label:"Cancel"},null,512),[[$]]),Q(l(u,{outline:"",label:"Save",onClick:t[2]||(t[2]=i=>this.autoAwesomeCB())},null,512),[[$]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),c("div",X,[l(M,{class:"bg-positive",modelValue:o.defaultExpanded,"onUpdate:modelValue":t[10]||(t[10]=i=>o.defaultExpanded=i)},{header:s(()=>[l(F,{class:"bg-positive text-white",style:{width:"100%"}},{default:s(()=>[c("div",Y,[a(" Course: "),this.reStore.courses.ck?(p(),B("span",Z,w(this.reStore.courses[this.reStore.courses.ck].title),1)):O("",!0)])]),_:1})]),default:s(()=>[this.reStore.ck?(p(),v(E,{key:0,flat:""},{default:s(()=>[l(_,{class:"text-center",style:{fontSize:"12pt"}},{default:s(()=>[a(" Title: "+w(this.reStore.courses[this.reStore.ck].title)+" \xA0",1),l(q,{class:"ptr",name:"edit",onClick:t[4]||(t[4]=i=>{o.prompt=!0,this.courseTitle=this.reStore.courses[this.reStore.courses.ck].title,this.courseKey=o.ck})}),c("div",ee,[l(b,null,{default:s(()=>[l(u,{icon:"delete",onClick:t[5]||(t[5]=i=>this.deleteCourseCB(this.reStore.courses.ck))},{default:s(()=>[l(m,null,{default:s(()=>[a("Delete Course")]),_:1})]),_:1}),l(u,{icon:"post_add",onClick:t[6]||(t[6]=i=>this.newAssignmentCB(this.reStore.courses.ck))},{default:s(()=>[l(m,null,{default:s(()=>[a("New Assignment")]),_:1})]),_:1}),l(u,{icon:"auto_awesome",onClick:t[7]||(t[7]=i=>{this.targetCK=o.ck,o.promptAwesome=!0})},{default:s(()=>[l(m,null,{default:s(()=>[a("1-Step Custom Assignment Create")]),_:1})]),_:1}),l(u,{icon:"content_copy",onClick:t[8]||(t[8]=i=>this.copyCK(o.ck))},{default:s(()=>[l(m,null,{default:s(()=>[a("Copy this course-key to clipboard. Enroll "),te,a("in this course using this course-key from "),oe,a("the Student Page.")]),_:1})]),_:1}),l(u,{icon:"home",onClick:t[9]||(t[9]=i=>this.reStore.router.push("/teacher"))},{default:s(()=>[l(m,null,{default:s(()=>[a("Return to dashboard")]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})):O("",!0)]),_:1},8,["modelValue"])]),this.course?(p(),B("div",se,[(p(!0),B(J,null,L(this.course.assignments,(i,f)=>(p(),v(E,{class:"acard bg-primary q-ma-sm",flat:"",bordered:"",modelValue:this.course.assignments,"onUpdate:modelValue":t[14]||(t[14]=d=>this.course.assignments=d),key:f},{default:s(()=>[l(U,{class:"aimg",src:i.coverUrl,onClick:d=>this.loadAssignmentCB(f)},{default:s(()=>[c("div",le,[c("div",ie,w(i.title.slice(0,10)),1),c("div",null,[c("span",ne,"Pages: "+w(i.pages.length),1)])]),l(b,{dense:"",class:"absolute-bottom justify-center",style:{"background-color":"#0000"}},{default:s(()=>[l(u,{dense:"",color:"",class:"on-left",icon:"delete",onClick:[t[11]||(t[11]=x(()=>{},["stop","prevent"])),d=>this.removeAssignmentCB(f)]},{default:s(()=>[l(m,null,{default:s(()=>[a("Delete Assignment")]),_:1})]),_:2},1032,["onClick"]),l(u,{dense:"",icon:"play_circle",onClick:[t[12]||(t[12]=x(()=>{},["stop","prevent"])),d=>this.takeAssignmentCB(f)]},{default:s(()=>[l(m,null,{default:s(()=>[a("Take Assignment")]),_:1})]),_:2},1032,["onClick"]),l(u,{dense:"",class:"on-right",icon:"edit",onClick:[t[13]||(t[13]=x(()=>{},["stop","prevent"])),d=>this.editAssignmentCB(f)]},{default:s(()=>[l(m,null,{default:s(()=>[a("Edit Assignment")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["src","onClick"])]),_:2},1032,["modelValue"]))),128))])):O("",!0)]),_:1})}var ae=P(z,[["render",re]]);const ue=K({name:"CourseEditorPage",components:{CourseEditor:ae},setup(o){const t=N();return{props:o,reStore:t}}});function ce(o,t,g,y,C,n){const i=W("CourseEditor");return p(),v(V,{id:"QPage",class:"row justify-center"},{default:s(()=>[l(i)]),_:1})}var $e=P(ue,[["render",ce]]);export{$e as default};
