import{e as ae,v as M,g as r,n as A,av as ne,h as D,i as ue,a4 as se,s as ie,k as le,aa as re,$ as ce}from"./index.a75cd14a.js";import{u as fe,v as R,a as de,b as ve,c as ge,r as H,s as he,p as K,d as me}from"./position-engine.61bb1987.js";import{u as Ce,a as Pe,b as Te,c as Se}from"./use-model-toggle.a1d88a19.js";import{u as ke,a as xe}from"./use-dark.66025dda.js";import{u as ye,b as be,c as Oe,d as qe,g as Be,e as Fe,f as W,a as Ee,k as we,h as Me}from"./focusout.10e086b2.js";import{g as Ae}from"./scroll.ab0372d2.js";function _e(){const e=new Map;return{getCache:function(o,a){return e[o]===void 0?e[o]=a:e[o]},getCacheWithFn:function(o,a){return e[o]===void 0?e[o]=a():e[o]}}}var $e=ae({name:"QMenu",inheritAttrs:!1,props:{...fe,...Ce,...ke,...ye,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:R},self:{type:String,validator:R},offset:{type:Array,validator:de},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...Pe,"click","escapeKey"],setup(e,{slots:o,emit:a,attrs:v}){let s=null,d,c,g;const S=le(),{proxy:h}=S,{$q:n}=h,u=M(null),i=M(!1),Q=r(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),_=xe(e,n),{registerTick:$,removeTick:j}=be(),{registerTimeout:k}=Te(),{transitionProps:I,transitionStyle:L}=Oe(e),{localScrollTarget:x,changeScrollEvent:U,unconfigureScrollTarget:z}=ve(e,E),{anchorEl:l,canShow:G}=ge({showing:i}),{hide:y}=Se({showing:i,canShow:G,handleShow:Y,handleHide:Z,hideOnRouteChange:Q,processOnMount:!0}),{showPortal:b,hidePortal:O,renderPortal:J}=qe(S,u,ee,"menu"),m={anchorEl:l,innerRef:u,onClickOutside(t){if(e.persistent!==!0&&i.value===!0)return y(t),(t.type==="touchstart"||t.target.classList.contains("q-dialog__backdrop"))&&ce(t),!0}},q=r(()=>K(e.anchor||(e.cover===!0?"center middle":"bottom start"),n.lang.rtl)),N=r(()=>e.cover===!0?q.value:K(e.self||"top start",n.lang.rtl)),V=r(()=>(e.square===!0?" q-menu--square":"")+(_.value===!0?" q-menu--dark q-dark":"")),X=r(()=>e.autoClose===!0?{onClick:p}:{}),B=r(()=>i.value===!0&&e.persistent!==!0);A(B,t=>{t===!0?(Me(P),me(m)):(W(P),H(m))});function C(){Ee(()=>{let t=u.value;t&&t.contains(document.activeElement)!==!0&&(t=t.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||t.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||t.querySelector("[autofocus], [data-autofocus]")||t,t.focus({preventScroll:!0}))})}function Y(t){if(s=e.noRefocus===!1?document.activeElement:null,Be(w),b(),E(),d=void 0,t!==void 0&&(e.touchPosition||e.contextMenu)){const T=ne(t);if(T.left!==void 0){const{top:te,left:oe}=l.value.getBoundingClientRect();d={left:T.left-oe,top:T.top-te}}}c===void 0&&(c=A(()=>n.screen.width+"|"+n.screen.height+"|"+e.self+"|"+e.anchor+"|"+n.lang.rtl,f)),e.noFocus!==!0&&document.activeElement.blur(),$(()=>{f(),e.noFocus!==!0&&C()}),k(()=>{n.platform.is.ios===!0&&(g=e.autoClose,u.value.click()),f(),b(!0),a("show",t)},e.transitionDuration)}function Z(t){j(),O(),F(!0),s!==null&&(t===void 0||t.qClickOutside!==!0)&&(((t&&t.type.indexOf("key")===0?s.closest('[tabindex]:not([tabindex^="-"])'):void 0)||s).focus(),s=null),k(()=>{O(!0),a("hide",t)},e.transitionDuration)}function F(t){d=void 0,c!==void 0&&(c(),c=void 0),(t===!0||i.value===!0)&&(Fe(w),z(),H(m),W(P)),t!==!0&&(s=null)}function E(){(l.value!==null||e.scrollTarget!==void 0)&&(x.value=Ae(l.value,e.scrollTarget),U(x.value,f))}function p(t){g!==!0?(we(h,t),a("click",t)):g=!1}function w(t){B.value===!0&&e.noFocus!==!0&&re(u.value,t.target)!==!0&&C()}function P(t){a("escapeKey"),y(t)}function f(){const t=u.value;t===null||l.value===null||he({el:t,offset:e.offset,anchorEl:l.value,anchorOrigin:q.value,selfOrigin:N.value,absoluteOffset:d,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function ee(){return D(se,I.value,()=>i.value===!0?D("div",{role:"menu",...v,ref:u,tabindex:-1,class:["q-menu q-position-engine scroll"+V.value,v.class],style:[v.style,L.value],...X.value},ue(o.default)):null)}return ie(F),Object.assign(h,{focus:C,updatePosition:f}),J}});export{$e as Q,_e as u};
