import{Q as $}from"./QPage.7d47aa6a.js";import{u as w,s as y}from"./re-store.dee276a0.js";import{a as d,Q as B}from"./QCardSection.7a8e8198.js";import{Q}from"./QKnob.a4c5cfee.js";import{e as T,r as g,u as E,_ as R,o as b,an as _,g as t,w as s,J as p,Q as r,aO as C,k as n,ap as m,j as a,aq as W,ar as U,f as G,l as F}from"./index.89842271.js";import{d as h,C as u,Q as f}from"./ClosePopup.8f1204f3.js";import{Q as S}from"./QCard.42ec64f3.js";import{Q as I}from"./QInput.eb11786c.js";import{Q as l}from"./QTooltip.59ddce99.js";import{Q as v}from"./QBtnGroup.235877a2.js";import{Q as k}from"./QPageSticky.7206b91f.js";import{s as A}from"./transform.aea72fbe.js";import"./firebase.79bf92f9.js";import"./index.2cf0d985.js";import"./TouchPan.14f31225.js";import"./use-form.24c9bae0.js";import"./use-prevent-scroll.86379370.js";import"./uid.4f7d2bc7.js";import"./use-dark.1ee1890c.js";import"./use-key-composition.f856fd0d.js";const N=T({name:"EditorComponent",props:{},setup(i){const e=w();return{props:i,reStore:e,imgCap:g(""),imgSrc:g(""),imgFit:g(""),pageText:g(""),promptAssignmentTitle:g(!1),promptPageTitle:g(!1),promptPctReplace:g(!1),promptLanguage:g(!1),promptGuideWords:g(!1)}},mounted(){console.log("EditorComponent.mounted"),E(this.reStore.courses,async(e,P)=>{console.log("Editor.watch"),e.ck,e.aid,e.pgIdx,e.imgIdx>this.reStore.page.imgs.length-1&&(e.imgIdx=0);const c=e.imgIdx;try{this.imgFit=this.reStore.page.imgFit,this.pageText=this.reStore.page.pageText,this.reStore.page.imgs.length>0?(console.log("try set editor img ",c,this.reStore.page.imgs),this.imgSrc=this.reStore.page.imgs[c].url,this.imgCap=this.reStore.page.imgs[c].cap):console.log("page doesnt have images YET")}catch(x){console.log("ERROR Editor watch ",x,c,this.reStore.page.imgs),this.imgSrc=this.reStore.page.imgs[0].url,this.imgCap=this.reStore.page.imgs[0].cap}},{immediate:!0,deep:!0}),this.reStore.courses.ck,this.reStore.courses.aid,this.reStore.courses.pgIdx;const i=this.reStore.courses.imgIdx;try{this.imgFit=this.reStore.page.imgFit,this.pageText=this.reStore.page.pageText,this.imgSrc=this.reStore.page.imgs[i].url,this.imgCap=this.reStore.page.imgs[i].cap}catch(e){console.log("ERROR Editor mounted",e)}},methods:{takeStorePage(){console.log("takeStorePage "),this.reStore.page.isCustom=!0,this.reStore.page.ck=this.reStore.ck,this.reStore.page.id=this.reStore.aid,this.reStore.page.currentLangLinks=[],this.reStore.courses[this.reStore.ck].assignments[this.reStore.aid].pages.push(JSON.parse(JSON.stringify(this.reStore.page))),this.reStore.courses.trigger+=1},restorePage(){console.log("Pager restorePage ");const i=this.reStore.ck,e=this.reStore.aid;this.reStore.page=JSON.parse(JSON.stringify(this.reStore.courses[i].assignments[e].pages[this.reStore.courses.pgIdx]))},updatePage(i){this.reStore.saveCurrentAssignment(),this.reStore.courses.trigger+=1},pctCB(i){this.targetPgIdx=i,this.targetPctReplace=this.assignment.pages[i].pctReplace,this.promptPctReplace=!0},updatePctReplaceCB(){console.log("updatePctReplaceCB "),this.assignment.pages[this.targetPgIdx].pctReplace=this.targetPctReplace,this.targetPgIdx==this.reStore.courses.pgIdx?(console.log("updating restore.page.pctReplace",this.targetPctReplace,this.assignment.pages[this.targetPgIdx].pctReplace),this.reStore.page.pctReplace=parseInt(this.targetPctReplace)):console.log("Not updating pctReplace",this.targetPgIdx,this.reStore.courses.pgIdx),this.targetPctReplace=null,this.targetPgIdx=null},wpCB(i){console.log("wpCB",i),this.reStore.page.pageid;const e=this.reStore.page.canonicalUrl;window.open(e,"_blank")},gwCB(i){console.log("updateGuideWords",i),this.targetPgIdx=i,this.targetGuideWords=this.assignment.pages[i].guideWords,this.promptGuideWords=!0},mapCB(i){const e="https://maps.google.com/?ll="+this.reStore.page.mapCoords.split(",")[0]+","+this.reStore.page.mapCoords.split(",")[1];window.open(e,"_blank")},updateGuideWordsCB(){console.log(),this.assignment.pages[this.targetPgIdx].guideWords=this.targetGuideWords,this.reStore.courses.pgIdx==this.targetPgIdx?(console.log("updating page guidewords"),this.reStore.page.guideWords=this.targetGuideWords,this.reStore.notify("page guide-words updated ")):console.log("NOT updating page guidewords",this.reStore.courses.pgIdx,this.targetPgIdx),this.targetPgIdx=null,this.targetGuideWords=null},async reloadPage(){console.log("Editor calling reloadPage"),await this.reStore.reloadPage(),console.log("Editor page.imgs ",this.reStore.page.imgs),this.imgFit=this.reStore.page.imgFit,this.pageText=this.reStore.page.pageText,this.imgSrc=this.reStore.page.imgs[0].url,this.imgCap=this.reStore.page.imgs[0].cap},saveImageCB(){const i=this.reStore.courses.imgIdx;this.reStore.saveImage(null,this.reStore.page.imgs[i]),this.reStore.notify("Image saved to MyImages")},prevImg(){this.reStore.page.imgIdx=this.reStore.page.imgIdx-1<0?this.reStore.page.imgs.length-1:this.reStore.page.imgIdx-1,this.reStore.courses.imgIdx=this.reStore.page.imgIdx,this.reStore.setStatus("imgIdx",this.imgIdx),this.imgSrc=this.reStore.page.imgs[this.reStore.courses.imgIdx].url,this.imgCap=this.reStore.page.imgs[this.reStore.courses.imgIdx].cap},nextImg(){this.reStore.page.imgIdx=this.reStore.page.imgIdx+1>this.reStore.page.imgs.length-1?0:this.reStore.page.imgIdx+1,this.reStore.courses.imgIdx=this.reStore.page.imgIdx,this.reStore.setStatus("imgIdx",this.reStore.courses.imgIdx),this.imgSrc=this.reStore.page.imgs[this.reStore.courses.imgIdx].url,this.imgCap=this.reStore.page.imgs[this.reStore.courses.imgIdx].cap},toggleText(){A("#slideTextDiv").classed("hidden")?y("#slideTextDiv").classed("hidden",!1):y("#slideTextDiv").classed("hidden",!0)},cycleFitMode(){const i=["scale-down","cover"];let e=i.indexOf(this.imgFit);e+=1,e>i.length-1&&(e=0),this.reStore.page.imgFit=i[e],this.reStore.courses.trigger+=1},setCover(){this.reStore.courses.ck,this.reStore.courses.aid,this.reStore.courses.pgIdx;const i=this.reStore.courses.imgIdx,e=this.reStore.page.imgs[i].url;this.reStore.setCover(this.reStore.page.imgs[i]),console.log("coverUrl ",e)}}}),q=n("div",{class:"text-h6"},"Percent Replace",-1),D=n("div",{class:"text-h6"},"Guide Words",-1),J=n("div",{class:"text-h6"},"Assignment Title",-1),K=n("div",{class:"text-h6"},"Page Title",-1),O={id:"slideCaptionDiv",class:"absolute-top text-subtitle1 text-center q-my-xl assignment",contentEditable:"true"},z={id:"slideTextDiv",class:"text-panel text-center absolute-center assignment",contentEditable:"true"},L={key:0},M={id:"coverSlideDiv",class:"flex flex-center cover-panel absolute-center coverslide hidden",contentEditable:"false"},H={class:"q-ma-md"},Y=n("br",null,null,-1),X=n("br",null,null,-1),Z={class:"q-ma-md"},j=n("br",null,null,-1),ee=n("br",null,null,-1),te=n("br",null,null,-1),se=n("br",null,null,-1);function ie(i,e,P,c,x,V){return b(),_(U,null,[t(f,{modelValue:i.promptPctReplace,"onUpdate:modelValue":e[2]||(e[2]=o=>i.promptPctReplace=o),persistent:""},{default:s(()=>[t(S,{style:{"min-width":"350px"}},{default:s(()=>[t(d,{align:"center"},{default:s(()=>[q]),_:1}),t(d,{class:"q-pt-none",align:"center"},{default:s(()=>[t(Q,{"show-value":"",size:"140px",thickness:.5,color:"green","track-color":"green-3","center-color":"grey-8",class:"text-white col q-ma-md",modelValue:i.targetPctReplace,"onUpdate:modelValue":e[0]||(e[0]=o=>i.targetPctReplace=o)},null,8,["modelValue"])]),_:1}),t(h,{align:"right"},{default:s(()=>[p(t(r,{outline:"",label:"Cancel"},null,512),[[u]]),p(t(r,{outline:"",label:"Update % replace",onClick:e[1]||(e[1]=o=>this.updatePctReplaceCB())},null,512),[[u]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(f,{modelValue:i.promptGuideWords,"onUpdate:modelValue":e[6]||(e[6]=o=>i.promptGuideWords=o),persistent:""},{default:s(()=>[t(S,{style:{"min-width":"350px"}},{default:s(()=>[t(d,null,{default:s(()=>[D]),_:1}),t(d,{class:"q-pt-none"},{default:s(()=>[t(I,{dense:"",modelValue:this.targetGuideWords,"onUpdate:modelValue":e[3]||(e[3]=o=>this.targetGuideWords=o),autofocus:"",onKeyup:e[4]||(e[4]=C(o=>i.promptGuideWords=!1,["enter"]))},null,8,["modelValue"])]),_:1}),t(h,{align:"right"},{default:s(()=>[p(t(r,{outline:"",label:"Cancel"},null,512),[[u]]),p(t(r,{outline:"",label:"Update guide words",onClick:e[5]||(e[5]=o=>this.updateGuideWordsCB())},null,512),[[u]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(f,{modelValue:i.promptAssignmentTitle,"onUpdate:modelValue":e[10]||(e[10]=o=>i.promptAssignmentTitle=o),persistent:""},{default:s(()=>[t(S,{style:{"min-width":"350px"}},{default:s(()=>[t(d,null,{default:s(()=>[J]),_:1}),t(d,{class:"q-pt-none"},{default:s(()=>[t(I,{dense:"",modelValue:this.assignment.title,"onUpdate:modelValue":e[7]||(e[7]=o=>this.assignment.title=o),autofocus:"",onKeyup:e[8]||(e[8]=C(o=>i.promptAssignmentTitle=!1,["enter"]))},null,8,["modelValue"])]),_:1}),t(h,{align:"right"},{default:s(()=>[p(t(r,{outline:"",label:"Cancel"},null,512),[[u]]),p(t(r,{outline:"",label:"Update assignment title",onClick:e[9]||(e[9]=o=>this.updateAssignmentTitle())},null,512),[[u]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(f,{modelValue:i.promptPageTitle,"onUpdate:modelValue":e[14]||(e[14]=o=>i.promptPageTitle=o),persistent:""},{default:s(()=>[t(S,{style:{"min-width":"350px"}},{default:s(()=>[t(d,null,{default:s(()=>[K]),_:1}),t(d,{class:"q-pt-none"},{default:s(()=>[t(I,{dense:"",modelValue:this.reStore.page.pageTitle,"onUpdate:modelValue":e[11]||(e[11]=o=>this.reStore.page.pageTitle=o),autofocus:"",onKeyup:e[12]||(e[12]=C(o=>i.promptAssignmentTitle=!1,["enter"]))},null,8,["modelValue"])]),_:1}),t(h,{align:"right"},{default:s(()=>[p(t(r,{outline:"",label:"Cancel"},null,512),[[u]]),p(t(r,{outline:"",label:"Update page title",onClick:e[13]||(e[13]=o=>this.updatePageTitle())},null,512),[[u]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(B,{class:"fixed-center",src:this.imgSrc,fit:this.imgFit,height:"100%"},{default:s(()=>[n("div",O,m(this.imgCap),1)]),_:1},8,["src","fit"]),n("div",z,m(this.pageText),1),this.reStore.courses.aid?(b(),_("span",L,[n("div",M,[n("div",H,[t(r,{style:{width:"200px",height:"200px","font-size":"12pt"},color:"primary"},{default:s(()=>[a(m(this.reStore.courses[this.reStore.courses.ck].assignments[this.reStore.courses.aid].title)+" ",1),Y,a(" "+m(this.reStore.courses[this.reStore.courses.ck].assignments[this.reStore.courses.aid].pages.length)+" Pages ",1),X,a(" "+m(this.reStore.courses[this.reStore.courses.ck].assignments[this.reStore.courses.aid].goal)+" Points ",1)]),_:1})]),n("div",Z,[t(r,{style:{width:"200px",height:"200px","font-size":"24pt"},stack:"",size:"xl","icon-right":"play_circle","text-color":"white",color:"primary",onClick:e[15]||(e[15]=o=>this.reStore.startAssignment())},{default:s(()=>[a("Start")]),_:1})])])])):W("",!0),t(k,{position:"bottom",offset:[0,10],class:"assignment"},{default:s(()=>[t(v,null,{default:s(()=>[t(r,{fab:"","label-position":"left",color:"primary",icon:"arrow_left",onClick:this.prevImg,padding:"sm"},{default:s(()=>[t(l,null,{default:s(()=>[a(" Previous image (same Wikipedia page) ")]),_:1})]),_:1},8,["onClick"]),t(r,{color:"primary"},{default:s(()=>[a(m(this.reStore.courses.imgIdx+1)+"/"+m(this.reStore.page.imgs.length),1)]),_:1}),t(r,{fab:"","label-position":"right",color:"primary",icon:"arrow_right",onClick:this.nextImg,padding:"sm"},null,8,["onClick"]),t(l,null,{default:s(()=>[a(" Next image (same Wikipedia page) ")]),_:1})]),_:1})]),_:1}),t(k,{position:"bottom",offset:[0,60],class:"assignment"},{default:s(()=>[t(v,null,{default:s(()=>[t(r,{fab:"","label-position":"right",color:"primary",icon:"add_photo_alternate",onClick:e[16]||(e[16]=o=>this.saveImageCB()),padding:"sm"},{default:s(()=>[t(l,null,{default:s(()=>[a("Bookmark this image")]),_:1})]),_:1}),t(r,{fab:"","label-position":"right",color:"primary",icon:"bookmark_add",onClick:e[17]||(e[17]=o=>this.reStore.saveBookmark()),padding:"sm"},{default:s(()=>[t(l,null,{default:s(()=>[a("Bookmark this page")]),_:1})]),_:1}),t(r,{fab:"","label-position":"right",color:"primary",icon:"fit_screen",onClick:this.cycleFitMode,padding:"sm"},{default:s(()=>[t(l,null,{default:s(()=>[a("Cycle through image-fit modes")]),_:1})]),_:1},8,["onClick"]),t(r,{fab:"","label-position":"right",color:"primary",icon:"article",onClick:this.toggleText,padding:"sm"},{default:s(()=>[t(l,null,{default:s(()=>[a("Show/Hide paragraph text in order to get"),j,a("better view of image.")]),_:1})]),_:1},8,["onClick"]),t(r,{fab:"","label-position":"right",color:"primary",icon:"title",onClick:this.setCover,padding:"sm"},{default:s(()=>[t(l,null,{default:s(()=>[a("Set current image as Cover Image for current assignment,"),ee,a("if there is an assignment currently loaded.")]),_:1})]),_:1},8,["onClick"]),t(r,{fab:"","label-position":"right",color:"primary",icon:"volume_up",onClick:e[18]||(e[18]=o=>this.reStore.speak()),padding:"sm"},{default:s(()=>[t(l,null,{default:s(()=>[a("Speak current text")]),_:1})]),_:1}),t(r,{fab:"","label-position":"right",color:"primary",icon:"arrow_right",onClick:this.reloadPage,padding:"xs"},{default:s(()=>[t(l,null,{default:s(()=>[a(" Reload page content. If Custom then no changes."),te,a(" If pageid, then only saved imgIdx applies."),se,a(" Else, reloads random with guid-words, if any. ")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1}),t(k,{position:"bottom",offset:[0,110],class:"assignment"},{default:s(()=>[t(v,null,{default:s(()=>[t(r,{fab:"","label-position":"left",color:"primary",icon:"input",onClick:e[19]||(e[19]=o=>i.takeStorePage(i.pgIdx)),padding:"sm"},{default:s(()=>[t(l,null,{default:s(()=>[a(" Pull editor page contents to this Page ")]),_:1})]),_:1}),t(r,{fab:"","label-position":"left",color:"primary",icon:"restore_page",onClick:e[20]||(e[20]=o=>i.restorePage(i.pgIdx)),padding:"sm"},{default:s(()=>[t(l,null,{default:s(()=>[a(" Restore page to saved values ")]),_:1})]),_:1}),t(r,{fab:"","label-position":"left",color:"primary",icon:"save",onClick:e[21]||(e[21]=o=>this.updatePage(i.pgIdx)),padding:"sm"},{default:s(()=>[t(l,null,{default:s(()=>[a(" Update & Save current page ")]),_:1})]),_:1}),t(r,{fab:"","label-position":"left",color:"primary",icon:"signpost",onClick:e[22]||(e[22]=o=>i.gwCB(i.pgIdx)),padding:"sm"},{default:s(()=>[t(l,null,{default:s(()=>[a(" Update & Save current page ")]),_:1})]),_:1}),t(r,{fab:"","label-position":"left",color:"primary",icon:"percent",onClick:e[23]||(e[23]=o=>i.pctCB(i.pgIdx)),padding:"sm"},{default:s(()=>[t(l,null,{default:s(()=>[a("Set percentage of words to replace from paragraph on this page ")]),_:1})]),_:1}),t(r,{fab:"","label-position":"left",color:"primary",icon:"location_on",onClick:e[24]||(e[24]=o=>i.mapCB(i.pgIdx)),padding:"sm"},{default:s(()=>[t(l,null,{default:s(()=>[a(" Launch Google Maps: ")]),_:1})]),_:1}),t(r,{fab:"","label-position":"left",color:"primary",icon:"language",onClick:e[25]||(e[25]=o=>i.wpCB(i.pgIdx)),padding:"sm"},{default:s(()=>[t(l,null,{default:s(()=>[a("Wikipedia page ")]),_:1})]),_:1})]),_:1})]),_:1})],64)}var oe=R(N,[["render",ie]]);const re=T({name:"EditorPage",components:{EditorComponent:oe},setup(i){const e=w();return{props:i,reStore:e}}});function ae(i,e,P,c,x,V){const o=F("EditorComponent");return b(),G($,{id:"QPage",class:"row justify-center"},{default:s(()=>[t(o)]),_:1})}var we=R(re,[["render",ae]]);export{we as default};
