import{Q}from"./QPage.9c246829.js";import{u as V}from"./re-store.f5ffde0d.js";import{Q as _}from"./QCardSection.c8861a2f.js";import{Q as P}from"./QInput.07e7b0f7.js";import{e as N,r as C,u as G,_ as K,o as g,f as A,w as l,g as o,aF as U,O as E,Q as f,k as n,aq as O,j as c,ar as k,i as y,aG as $,at as I,aH as q,l as D}from"./index.68e41f27.js";import{Q as L,d as J,C as b}from"./ClosePopup.fde4cf5d.js";import{Q as v}from"./QCard.07deebd8.js";import{Q as W}from"./QBanner.3bbdf978.js";import{Q as h}from"./QTooltip.fcc777c8.js";import{Q as j}from"./QImg.0e00d62b.js";import"./firebase.79bf92f9.js";import"./transform.aea72fbe.js";import"./index.2cf0d985.js";import"./use-dark.c931a06d.js";import"./use-prevent-scroll.e10f56a0.js";import"./scroll.aa1add39.js";import"./use-form.0f96e925.js";const R=N({name:"CourseEditor",setup(){return{reStore:V(),course:C(null),promptAwesome:C(!1),targetCK:C(null),targetAID:C(null),autoAwesomeGuideWords:C("")}},mounted(){console.log("CE mounted"),G(this.reStore.courses,async(t,s)=>{if(console.log("CE watcher ",t,s),!this.assignment||this.assignment.id!==t.aid){const p=this.reStore.courses.ck;this.course=JSON.parse(JSON.stringify(this.reStore.courses[p]))}});try{if(!this.course||this.course.courseKey!==newObj.ck){const t=this.reStore.courses.ck;this.course=JSON.parse(JSON.stringify(this.reStore.courses[t]))}}catch(t){console.log(t)}},methods:{autoAwesomeCB(t){console.log("autoAwesomeCB ",this.autoAwesomeGuideWords);const s=this.autoAwesomeGuideWords.split(","),p=200,x=p/s.length;let m=parseInt(x/6);m<1&&(m=1);const r=JSON.parse(JSON.stringify(this.reStore.assignmentTemplate));r.ck=this.targetCK,r.id=this.reStore.mkId(),r.pgIdx=0,r.coverUrl=null,r.title=s[0],r.goal=p,s.forEach(async i=>{const d=this.reStore.langVoices[this.reStore.preferences.langVoiceKey];console.log("doSearch ",d,this.searchTerms),this.reStore.wiki.setLang(d.langName);const u=await this.reStore.wiki.search(i,{suggestion:!1,limit:m});console.log("res.results.length: ",u.results.length),console.log(u.results),u.results.forEach(async S=>{console.log(S.pageid),await this.reStore.getPage2(null,S.pageid,this.reStore.preferences.langVoiceKey).then(async a=>{console.log("getPage returned rval ",a),a.pageTitle=S.title;const w=await this.reStore.wiki.page(S.pageid);a.canonicalUrl=w.canonicalurl;const B=await w.summary();if(B.type!=="disambiguation"){if(await w.coordinates().then(e=>{console.log("resolved coords ",e),e!==null?a.mapCoords=`${e.lat}, ${e.lon}`:a.mapCoords="-999, -999"}),await w.images({limit:this.reStore.preferences.imgLimit}).then(e=>{for(const T in e)console.log(T),e[0].title.indexOf(".svg")>1?console.log("SVG ",e[0].title):e[0].title.indexOf("airytale")>0?console.log("Fairytale warning ",e[0].title):e[0].title.indexOf("kguitar")>1?console.log("kguitar ",e[0].title):e[0].title.indexOf("Blank.png")>-1?console.log("Blank.png ",e[0].title):e[0].title.indexOf(".oga")>1?console.log("OGA ",e[0].title):e[0].title.indexOf(".webm")>1?console.log("WEBM ",e[0].title):e[0].title.indexOf(".ogg")>1?console.log("OGG ",e[0].title):e[0].title.indexOf(".tif")>1?console.log("TIF ",e[0].title):e[0].title.indexOf(".mid")>1?console.log("MID ",e[0].title):e[0].title.indexOf(".ogv")>1?console.log("OGV ",e[0].title):e[0].title.indexOf("Icon")>1?console.log("ICON ",e[0].title):e[0].title.indexOf("icon")>1?console.log("icon ",e[0].title):e[0].title.indexOf("podagraria1")>0?console.log("podagraria1 ",e[0].title):e[0].title.indexOf("Bluetank")>1||e[0].title.indexOf("rab Nebula.jpg")>0?console.log("BLUETANK ",e[0].title):e[0].title.indexOf("viacionavion")>1||e[0].title.indexOf("input-microphone")>1?console.log("viacionavion",e[0].title):e[0].title.indexOf("clouds in fair weather")>0||e[0].title.indexOf("in pacifica 1")>0?console.log("clouds in fair weather",e[0].title):a.imgs.push({url:e[0].url,cap:e[0].title}),e.push(e.shift());a.imgs.length>1&&a.imgs.shift()}),a.pageText=B.extract,a.currentLangLinks=[],a.imgIdx=0,!r.coverUrl)try{r.coverUrl=r.pages[0].imgs[0].url}catch(e){console.log("ERROR setting coverUrl ",e)}r.pages.push(a),console.log("a.pages.length ",r.pages.length)}else console.log("SKIPPED ",B.type)})})}),this.reStore.courses[this.reStore.courses.ck].assignments||(this.reStore.courses[this.reStore.courses.ck].assignments={}),this.reStore.courses[this.reStore.courses.ck].assignments[r.id]=r,this.reStore.courses.trigger+=1},takeAssignmentCB(t){console.log("CE takeAssignmentCB ",t),t!==this.reStore.courses.aid&&this.loadAssignmentCB(t),this.reStore.router.push("/teacher/assignment")},editAssignmentCB(t){console.log("CE editAssignmentCB ",t),t!==this.reStore.courses.aid&&this.loadAssignmentCB(t),this.reStore.router.push("/teacher/editor")},loadAssignmentCB(t){const s=this.reStore.courses.ck;console.log("CE loadAssignmentCB ",s,t),this.reStore.loadAssignment(s,t),this.reStore.courses.selectedRHSTab="pagerTab"},newAssignmentCB(t){console.log("assignmentCB: ",t),this.reStore.newAssignment(t)},dummy(){console.log("dummy")}}}),F=n("div",{class:"text-h6"},"Provide guide-words",-1),z={class:"q-pa-md"},H={key:0,class:"text-weight-bolder text-center text-h4 q-pa-md"},M=n("br",null,null,-1),X=n("br",null,null,-1),Y=n("br",null,null,-1),Z={class:"flex flex-row justify-center"},ee={key:0,class:"flex flex-row justify-center"},te={class:"absolute-top text-center"},se={class:"text-h6"},oe={class:"text-subtitle2"},le={style:{"font-size":"22pt",width:"100%"},class:"text-center absolute-bottom"};function ie(t,s,p,x,m,r){return g(),A(Q,{class:"q-gutter-md bg-primary",style:{width:"100%"}},{default:l(()=>[o(L,{modelValue:t.promptAwesome,"onUpdate:modelValue":s[3]||(s[3]=i=>t.promptAwesome=i),persistent:"",class:"z-max"},{default:l(()=>[o(v,{style:{"min-width":"350px"}},{default:l(()=>[o(_,null,{default:l(()=>[F]),_:1}),o(_,{class:"q-pt-none"},{default:l(()=>[o(P,{dense:"",modelValue:t.autoAwesomeGuideWords,"onUpdate:modelValue":s[0]||(s[0]=i=>t.autoAwesomeGuideWords=i),autofocus:"",onKeyup:s[1]||(s[1]=U(i=>{t.promptAwesome=!1,this.autoAwesomeCB()},["enter"]))},null,8,["modelValue"])]),_:1}),o(J,{align:"right",class:"text-white"},{default:l(()=>[E(o(f,{outline:"",label:"Cancel"},null,512),[[b]]),E(o(f,{outline:"",label:"Save",onClick:s[2]||(s[2]=i=>this.autoAwesomeCB())},null,512),[[b]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n("div",z,[o(W,{class:"bg-positive text-white"},{default:l(()=>[this.reStore.courses.ck?(g(),O("div",H,[c(" Course: "+k(this.reStore.courses[this.reStore.courses.ck].title)+" ",1),o(y,{class:"on-right float-right",name:"edit"})])):$("",!0)]),_:1})]),o(v,{flat:""},{default:l(()=>[o(_,{class:"text-center",style:{fontSize:"12pt"}},{default:l(()=>[c(" Title: "+k(this.reStore.courses[this.reStore.courses.ck].title)+" \xA0",1),o(y,{class:"ptr",name:"edit",onClick:s[4]||(s[4]=i=>{t.prompt=!0,this.courseTitle=this.reStore.courses[this.reStore.courses.ck].title,this.courseKey=t.ck})}),M,c(" Key: "+k(this.reStore.courses.ck)+" ",1),o(y,{class:"ptr",name:"content_copy",onClick:s[5]||(s[5]=i=>this.copyCK(this.reStore.courses.ck))}),n("div",null,[o(f,{icon:"delete",onClick:s[6]||(s[6]=i=>this.deleteCourseCB(this.reStore.courses.ck))},{default:l(()=>[o(h,null,{default:l(()=>[c("Delete Course")]),_:1})]),_:1}),o(f,{icon:"post_add",onClick:s[7]||(s[7]=i=>this.newAssignmentCB(this.reStore.courses.ck))},{default:l(()=>[o(h,null,{default:l(()=>[c("New Assignment")]),_:1})]),_:1}),o(f,{icon:"auto_awesome",onClick:s[8]||(s[8]=i=>{this.targetCK=t.ck,t.promptAwesome=!0})},{default:l(()=>[o(h,null,{default:l(()=>[c("1-Step Custom Assignment Create")]),_:1})]),_:1}),o(f,{icon:"content_copy",onClick:s[9]||(s[9]=i=>this.copyCK(t.ck))},{default:l(()=>[o(h,null,{default:l(()=>[c("Copy this course-key to clipboard. Enroll "),X,c("in this course using this course-key from "),Y,c("the Student Page.")]),_:1})]),_:1})])]),_:1})]),_:1}),o(v,{flat:"",class:"q-pa-sm"},{default:l(()=>[n("div",Z,[this.reStore.courses.ck?(g(),A(_,{key:0},{default:l(()=>[this.course?(g(),O("div",ee,[(g(!0),O(I,null,q(this.course.assignments,(i,d)=>(g(),A(v,{class:"ccard bg-primary q-pa-xs q-ma-sm",flat:"",bordered:"",modelValue:this.course.assignments,"onUpdate:modelValue":s[10]||(s[10]=u=>this.course.assignments=u),key:d},{default:l(()=>[o(j,{height:"250px",width:"100%",src:i.coverUrl,onClick:u=>this.loadAssignmentCB(d)},{default:l(()=>[n("div",te,[n("div",se,k(i.title.slice(0,18)),1),n("div",oe,[n("span",null,"Pages: "+k(i.pages.length),1)])]),n("div",le,[n("div",null,[o(y,{color:"red",class:"ptr",name:"delete",onClick:u=>this.deleteAssignmentCB(d)},{default:l(()=>[o(h,null,{default:l(()=>[c("Delete Assignment")]),_:1})]),_:2},1032,["onClick"]),o(f,{icon:"play",onClick:u=>this.takeAssignmentCB(d)},{default:l(()=>[o(h,null,{default:l(()=>[c("Take Assignment")]),_:1})]),_:2},1032,["onClick"]),o(f,{icon:"edit",onClick:u=>this.editAssignmentCB(d)},{default:l(()=>[o(h,null,{default:l(()=>[c("Edit Assignment")]),_:1})]),_:2},1032,["onClick"])])])]),_:2},1032,["src","onClick"])]),_:2},1032,["modelValue"]))),128))])):$("",!0)]),_:1})):$("",!0)])]),_:1})]),_:1})}var re=K(R,[["render",ie]]);const ne=N({name:"CourseEditorPage",components:{CourseEditor:re},setup(t){const s=V();return{props:t,reStore:s}}});function ae(t,s,p,x,m,r){const i=D("CourseEditor");return g(),A(Q,{id:"QPage",class:"row justify-center"},{default:l(()=>[o(i)]),_:1})}var Be=K(ne,[["render",ae]]);export{Be as default};
