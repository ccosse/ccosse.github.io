import{Q as N}from"./QPage.b2d64fba.js";import{u as T}from"./re-store.93599b2f.js";import{Q as _}from"./QCardSection.80507a04.js";import{Q as U}from"./QInput.30104352.js";import{e as K,r as C,u as I,_ as P,o as p,f as x,w as l,g as o,aF as D,O as $,Q as u,k as d,aq as A,j as a,ar as w,i as b,aG as E,at as q,aH as L,aI as B,l as J}from"./index.8cba108b.js";import{Q as R,d as W,C as Q}from"./ClosePopup.84aa0d11.js";import{Q as O}from"./QCard.24cd4721.js";import{Q as j}from"./QBanner.a581b95a.js";import{Q as g}from"./QTooltip.0a15b80a.js";import{Q as V}from"./QBtnGroup.a3fc8c06.js";import{Q as F}from"./QImg.a8f49500.js";import"./firebase.79bf92f9.js";import"./transform.aea72fbe.js";import"./index.2cf0d985.js";import"./use-dark.89370604.js";import"./use-prevent-scroll.88cb2f6f.js";import"./scroll.c24c3931.js";import"./use-form.7ad84da5.js";const M=K({name:"CourseEditor",setup(){return{reStore:T(),course:C(null),promptAwesome:C(!1),targetCK:C(null),targetAID:C(null),autoAwesomeGuideWords:C("")}},mounted(){console.log("CE mounted"),I(this.reStore.courses,async(s,t)=>{if(console.log("CE watcher ",s,t),!this.assignment||this.assignment.id!==s.aid){const m=this.reStore.courses.ck;this.course=JSON.parse(JSON.stringify(this.reStore.courses[m]))}});try{if(!this.course||this.course.courseKey!==newObj.ck){const s=this.reStore.courses.ck;this.course=JSON.parse(JSON.stringify(this.reStore.courses[s]))}}catch(s){console.log(s)}},methods:{autoAwesomeCB(s){console.log("autoAwesomeCB ",this.autoAwesomeGuideWords);const t=this.autoAwesomeGuideWords.split(","),m=200,v=m/t.length;let h=parseInt(v/6);h<1&&(h=1);const r=JSON.parse(JSON.stringify(this.reStore.assignmentTemplate));r.ck=this.targetCK,r.id=this.reStore.mkId(),r.pgIdx=0,r.coverUrl=null,r.title=t[0],r.goal=m,t.forEach(async i=>{const f=this.reStore.langVoices[this.reStore.preferences.langVoiceKey];console.log("doSearch ",f,this.searchTerms),this.reStore.wiki.setLang(f.langName);const c=await this.reStore.wiki.search(i,{suggestion:!1,limit:h});console.log("res.results.length: ",c.results.length),console.log(c.results),c.results.forEach(async k=>{console.log(k.pageid),await this.reStore.getPage2(null,k.pageid,this.reStore.preferences.langVoiceKey).then(async n=>{console.log("getPage returned rval ",n),n.pageTitle=k.title;const S=await this.reStore.wiki.page(k.pageid);n.canonicalUrl=S.canonicalurl;const y=await S.summary();if(y.type!=="disambiguation"){if(await S.coordinates().then(e=>{console.log("resolved coords ",e),e!==null?n.mapCoords=`${e.lat}, ${e.lon}`:n.mapCoords="-999, -999"}),await S.images({limit:this.reStore.preferences.imgLimit}).then(e=>{for(const G in e)console.log(G),e[0].title.indexOf(".svg")>1?console.log("SVG ",e[0].title):e[0].title.indexOf("airytale")>0?console.log("Fairytale warning ",e[0].title):e[0].title.indexOf("kguitar")>1?console.log("kguitar ",e[0].title):e[0].title.indexOf("Blank.png")>-1?console.log("Blank.png ",e[0].title):e[0].title.indexOf(".oga")>1?console.log("OGA ",e[0].title):e[0].title.indexOf(".webm")>1?console.log("WEBM ",e[0].title):e[0].title.indexOf(".ogg")>1?console.log("OGG ",e[0].title):e[0].title.indexOf(".tif")>1?console.log("TIF ",e[0].title):e[0].title.indexOf(".mid")>1?console.log("MID ",e[0].title):e[0].title.indexOf(".ogv")>1?console.log("OGV ",e[0].title):e[0].title.indexOf("Icon")>1?console.log("ICON ",e[0].title):e[0].title.indexOf("icon")>1?console.log("icon ",e[0].title):e[0].title.indexOf("podagraria1")>0?console.log("podagraria1 ",e[0].title):e[0].title.indexOf("Bluetank")>1||e[0].title.indexOf("rab Nebula.jpg")>0?console.log("BLUETANK ",e[0].title):e[0].title.indexOf("viacionavion")>1||e[0].title.indexOf("input-microphone")>1?console.log("viacionavion",e[0].title):e[0].title.indexOf("clouds in fair weather")>0||e[0].title.indexOf("in pacifica 1")>0?console.log("clouds in fair weather",e[0].title):n.imgs.push({url:e[0].url,cap:e[0].title}),e.push(e.shift());n.imgs.length>1&&n.imgs.shift()}),n.pageText=y.extract,n.currentLangLinks=[],n.imgIdx=0,!r.coverUrl)try{r.coverUrl=r.pages[0].imgs[0].url}catch(e){console.log("ERROR setting coverUrl ",e)}r.pages.push(n),console.log("a.pages.length ",r.pages.length)}else console.log("SKIPPED ",y.type)})})}),this.reStore.courses[this.reStore.courses.ck].assignments||(this.reStore.courses[this.reStore.courses.ck].assignments={}),this.reStore.courses[this.reStore.courses.ck].assignments[r.id]=r,this.reStore.courses.trigger+=1},takeAssignmentCB(s){console.log("CE takeAssignmentCB ",s),s!==this.reStore.courses.aid&&this.loadAssignmentCB(s),this.reStore.router.push("/teacher/assignment")},editAssignmentCB(s){console.log("CE editAssignmentCB ",s),s!==this.reStore.courses.aid&&this.loadAssignmentCB(s),this.reStore.router.push("/teacher/editor")},loadAssignmentCB(s){const t=this.reStore.courses.ck;console.log("CE loadAssignmentCB ",t,s),this.reStore.loadAssignment(t,s),this.reStore.courses.selectedRHSTab="pagerTab"},newAssignmentCB(s){console.log("assignmentCB: ",s),this.reStore.newAssignment(s)},removeAssignmentCB(s){const t=this.reStore.courses.ck;console.log("removeAssignmentCB",t,s),this.reStore.deleteAssignment(t,s),console.log("done")},dummy(){console.log("dummy")}}}),z=d("div",{class:"text-h6"},"Provide guide-words",-1),H={class:"q-pa-md"},X={key:0,class:"text-weight-bolder text-center text-h4 q-pa-md"},Y={class:"q-ma-sm"},Z=d("br",null,null,-1),ee=d("br",null,null,-1),te={key:0,class:"flex flex-row justify-center"},se={class:"absolute-top text-center",style:{"background-color":"#2228",height:"100%"}},oe={class:"atit"},le={class:"asub"};function ie(s,t,m,v,h,r){return p(),x(N,{class:"q-gutter-md bg-primary",style:{width:"100%"}},{default:l(()=>[o(R,{modelValue:s.promptAwesome,"onUpdate:modelValue":t[3]||(t[3]=i=>s.promptAwesome=i),persistent:"",class:"z-max"},{default:l(()=>[o(O,{style:{"min-width":"350px"}},{default:l(()=>[o(_,null,{default:l(()=>[z]),_:1}),o(_,{class:"q-pt-none"},{default:l(()=>[o(U,{dense:"",modelValue:s.autoAwesomeGuideWords,"onUpdate:modelValue":t[0]||(t[0]=i=>s.autoAwesomeGuideWords=i),autofocus:"",onKeyup:t[1]||(t[1]=D(i=>{s.promptAwesome=!1,this.autoAwesomeCB()},["enter"]))},null,8,["modelValue"])]),_:1}),o(W,{align:"right",class:"text-white"},{default:l(()=>[$(o(u,{outline:"",label:"Cancel"},null,512),[[Q]]),$(o(u,{outline:"",label:"Save",onClick:t[2]||(t[2]=i=>this.autoAwesomeCB())},null,512),[[Q]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),d("div",H,[o(j,{class:"bg-positive text-white"},{default:l(()=>[this.reStore.courses.ck?(p(),A("div",X,[a(" Course: "+w(this.reStore.courses[this.reStore.courses.ck].title)+" ",1),o(b,{class:"on-right float-right",name:"edit"})])):E("",!0)]),_:1})]),o(O,{flat:""},{default:l(()=>[o(_,{class:"text-center",style:{fontSize:"12pt"}},{default:l(()=>[a(" Title: "+w(this.reStore.courses[this.reStore.courses.ck].title)+" \xA0",1),o(b,{class:"ptr",name:"edit",onClick:t[4]||(t[4]=i=>{s.prompt=!0,this.courseTitle=this.reStore.courses[this.reStore.courses.ck].title,this.courseKey=s.ck})}),d("div",Y,[o(V,null,{default:l(()=>[o(u,{icon:"delete",onClick:t[5]||(t[5]=i=>this.deleteCourseCB(this.reStore.courses.ck))},{default:l(()=>[o(g,null,{default:l(()=>[a("Delete Course")]),_:1})]),_:1}),o(u,{icon:"post_add",onClick:t[6]||(t[6]=i=>this.newAssignmentCB(this.reStore.courses.ck))},{default:l(()=>[o(g,null,{default:l(()=>[a("New Assignment")]),_:1})]),_:1}),o(u,{icon:"auto_awesome",onClick:t[7]||(t[7]=i=>{this.targetCK=s.ck,s.promptAwesome=!0})},{default:l(()=>[o(g,null,{default:l(()=>[a("1-Step Custom Assignment Create")]),_:1})]),_:1}),o(u,{icon:"content_copy",onClick:t[8]||(t[8]=i=>this.copyCK(s.ck))},{default:l(()=>[o(g,null,{default:l(()=>[a("Copy this course-key to clipboard. Enroll "),Z,a("in this course using this course-key from "),ee,a("the Student Page.")]),_:1})]),_:1}),o(u,{icon:"home",onClick:t[9]||(t[9]=i=>this.reStore.router.push("/teacher"))},{default:l(()=>[o(g,null,{default:l(()=>[a("Return to dashboard")]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),this.course?(p(),A("div",te,[(p(!0),A(q,null,L(this.course.assignments,(i,f)=>(p(),x(O,{class:"acard bg-primary q-ma-sm",flat:"",bordered:"",modelValue:this.course.assignments,"onUpdate:modelValue":t[13]||(t[13]=c=>this.course.assignments=c),key:f},{default:l(()=>[o(F,{class:"aimg",src:i.coverUrl,onClick:c=>this.loadAssignmentCB(f)},{default:l(()=>[d("div",se,[d("div",oe,w(i.title.slice(0,10)),1),d("div",null,[d("span",le,"Pages: "+w(i.pages.length),1)])]),o(V,{dense:"",class:"absolute-bottom justify-center",style:{"background-color":"#0000"}},{default:l(()=>[o(u,{dense:"",color:"",class:"on-left",icon:"delete",onClick:[t[10]||(t[10]=B(()=>{},["stop","prevent"])),c=>this.removeAssignmentCB(f)]},{default:l(()=>[o(g,null,{default:l(()=>[a("Delete Assignment")]),_:1})]),_:2},1032,["onClick"]),o(u,{dense:"",icon:"play_circle",onClick:[t[11]||(t[11]=B(()=>{},["stop","prevent"])),c=>this.takeAssignmentCB(f)]},{default:l(()=>[o(g,null,{default:l(()=>[a("Take Assignment")]),_:1})]),_:2},1032,["onClick"]),o(u,{dense:"",class:"on-right",icon:"edit",onClick:[t[12]||(t[12]=B(()=>{},["stop","prevent"])),c=>this.editAssignmentCB(f)]},{default:l(()=>[o(g,null,{default:l(()=>[a("Edit Assignment")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["src","onClick"])]),_:2},1032,["modelValue"]))),128))])):E("",!0)]),_:1})}var re=P(M,[["render",ie]]);const ne=K({name:"CourseEditorPage",components:{CourseEditor:re},setup(s){const t=T();return{props:s,reStore:t}}});function ae(s,t,m,v,h,r){const i=J("CourseEditor");return p(),x(N,{id:"QPage",class:"row justify-center"},{default:l(()=>[o(i)]),_:1})}var xe=P(ne,[["render",ae]]);export{xe as default};
